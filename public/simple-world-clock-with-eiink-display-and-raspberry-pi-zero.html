<!doctype html><html lang=en-us><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL69vf8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv76+/8LBwQkAAAAAAAAAAAAAAAC+vb3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL+9vf/Bv78JAAAAAAAAAAAAAAAAu7q6/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC7ubr/vr29CAAAAAAAAAAAy8nJAZ6foP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnqGj/6GipAoAAAAAHLjU/xcXHf/BwsL/I8XY/yPK3v8XGiD/IbjL/yPF2f8XGiD/Fxkf/yLF2f8gnK3/Fxog/62ztv8fwNf/FRcd/x271v8mz93/GRsi/xkXHf8p097/GiIp/xobIv8p0t3/KdPe/xocIv8fYmr/KNPe/xoZH/8aHCL/J87c/xy81/8VFxz/IsPZ/8zS0/8XGiD/Ir/R/yPH2/8XGiD/Fxkf/yPH2/8dd4T/GBog/yPJ3f8jyNr/uru9/xcUGv8cudb/EhITDKi5vRKlvMP/RUpOERwcHRAdOj4QHTk8EBwdHRAdNTgQHTo/EBwcHRAcHB0QSGduEKW4vf+koqQfHzg+EBqz0ewSFRv7EyMr/xq51vsTERb7ExUb+xq41fsau9j7ExUb+xiPp/sZudb7ExUb+xMVG/sZuNX/GKvI/BIUGfMdvdn/IrfL/xcaIP8n1eb/J9Dh/xkcIf8ZGR7/J8/f/xxCSv8ZGyH/J9Dg/ybQ4P8ZHCL/FSQs/yPK3/8UExj/GE1b/ybS5P8ZGB7/Ghwj/ynW5P8p2Ob/Ghwi/yWrtv8p1eH/Ghwi/xocIv8p1uT/J8XT/xkcIv8m1un/Hb7d/xUYH/8hzOr/HtHu/xcaIf8XGB//I8vi/xgxOv8XGSD/I8rg/yPK4P8XGiD/GUFL/yPP6f8SERj/Fhkh/x3A4f8AAAAAJ2f9/ydr//8mZPH/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlYu38J2v//ydo/f8AAAAAAAAAAAd8/fkFqf//Iob8sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMY39awWr//8FfP3/AAAAAAAAAAAFm/7/SfD//wR+/f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOB/f9B7v//BaX+/wAAAAAAAAAAQ878SAyZ/v9n1v4KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADu9v8DDJb+/z3N/XgAAAAA3/sAAN/7AADf+wAA3/sAAAAAAAAAAAAAAAAAAN/7AAAAAAAAAAAAAAAAAAAAAAAAj/EAAI/5AACP8QAA3/sAAA==" rel=icon type=image/x-icon><title>Simple world clock with eInk display and Raspberry Pi Zero</title><meta name=description content="Our team is spread across the world, from the USA all the way to Australia, sohaving some sort of world clock makes sense."><link rel=alternate type=application/rss+xml title="Mitja Felicijan's posts" href=https://mitjafelicijan.com/index.xml><link rel=alternate type=application/rss+xml title="Mitja Felicijan's notes" href=https://mitjafelicijan.com/notes.xml><style>body{padding:1rem;max-width:760px;background:#fff;font-family:times new roman,Times,serif;line-height:1.35rem}hr{margin-block-start:1.5rem}h1,h2,h3{line-height:initial}footer{margin-block-start:3rem}table{max-width:100%;border-collapse:separate;border-spacing:2px;border:1px solid #000;border-left:1px solid #999;border-top:1px solid #999}blockquote{font-style:italic}table thead{background:#eee}td,th{border:1px solid #000;padding:4px;border-right:1px solid #999;border-bottom:1px solid #999;text-align:left}pre{text-wrap:nowrap;overflow-x:auto;margin-block-start:1.5rem;margin-block-end:1.5rem;padding:.5rem 0;border-top:1px solid #000;border-bottom:1px solid #000}pre code{line-height:1.3em}pre,code,pre *,code *{font-family:monospace;font-size:initial!important}img,video,audio{max-width:100%}header{display:flex;flex-direction:row;gap:3rem}nav{display:flex;gap:.75rem}.pstatus-orange{background:gold}.pstatus-green{background:#9acd32}.pstatus-red{background:#cd5c5c}@media only screen and (max-width:600px){header{flex-direction:column;gap:1rem}a{word-wrap:break-word}}</style><header><nav class=main><a href=/>Home</a>
<a href=https://git.mitjafelicijan.com/ target=_blank>Git</a>
<a href=https://files.mitjafelicijan.com/ target=_blank>Files</a>
<a href=/mitjafelicijan.pgp.pub.txt target=_blank>PGP</a>
<a href=/curriculum-vitae.html>CV</a>
<a href=/index.xml target=_blank>RSS</a></nav></header><main><div><h1>Simple world clock with eInk display and Raspberry Pi Zero</h1><p>Jun 26, 2021<div><p>Our team is spread across the world, from the USA all the way to Australia, so
having some sort of world clock makes sense.<p>Currently, I am using an extension for Gnome called <a href=https://extensions.gnome.org/extension/2657/timezones-extension/>Timezone
extension</a>,
and it serves the purpose quite well.<p>But I also have a bunch of electronics that I bought through the time, and I am
not using any of them, and it's time to stop hording this stuff and use it in a
project.<p>A while ago I bought a small eInk display <a href="https://shop.pimoroni.com/products/inky-phat?variant=12549254217811">Inky
pHAT</a> and I
have a bunch of <a href=https://www.raspberrypi.org/products/raspberry-pi-zero/>Raspberry Pi's
Zero</a> lying around that
I really need to use.<p><img src=/assets/world-clock/hardware.jpg alt="Inky pHAT, Raspberry Pi Zero"><p>Since the Inky <a href="https://shop.pimoroni.com/products/inky-phat?variant=12549254217811">Inky
pHAT</a> is
essentially a HAT, it can easily be added on top of the <a href=https://www.raspberrypi.org/products/raspberry-pi-zero/>Raspberry Pi
Zero</a>.<p>First, I installed the necessary software on Raspberry Pi with <code>pip3 install inky</code>.<p>And then I created a file <code>clock.py</code> in home directory <code>/home/pi</code>.<pre tabindex=0 style=background-color:#fff><code><span style=display:flex><span><span style=color:green>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:green># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>import</span> sys
</span></span><span style=display:flex><span><span style=color:#00f>import</span> os
</span></span><span style=display:flex><span><span style=color:#00f>from</span> inky.auto <span style=color:#00f>import</span> auto
</span></span><span style=display:flex><span><span style=color:#00f>from</span> PIL <span style=color:#00f>import</span> Image, ImageFont, ImageDraw
</span></span><span style=display:flex><span><span style=color:#00f>from</span> font_fredoka_one <span style=color:#00f>import</span> FredokaOne
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clocks = [
</span></span><span style=display:flex><span>  <span style=color:#a31515>&#39;America/New_York&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a31515>&#39;Europe/Ljubljana&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a31515>&#39;Australia/Brisbane&#39;</span>,
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>board = auto()
</span></span><span style=display:flex><span>board.set_border(board.WHITE)
</span></span><span style=display:flex><span>board.rotation = 90
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>img = Image.new(<span style=color:#a31515>&#39;P&#39;</span>, (board.WIDTH, board.HEIGHT))
</span></span><span style=display:flex><span>draw = ImageDraw.Draw(img)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>big_font = ImageFont.truetype(FredokaOne, 18)
</span></span><span style=display:flex><span>small_font = ImageFont.truetype(FredokaOne, 13)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x = board.WIDTH / 3
</span></span><span style=display:flex><span>y = board.HEIGHT / 3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>idx = 1
</span></span><span style=display:flex><span><span style=color:#00f>for</span> clock <span style=color:#00f>in</span> clocks:
</span></span><span style=display:flex><span>  ctime = os.popen(<span style=color:#a31515>&#39;TZ=&#34;</span><span style=color:#a31515>{}</span><span style=color:#a31515>&#34; date +&#34;</span><span style=color:#a31515>%a</span><span style=color:#a31515>,%H:%M&#34;&#39;</span>.format(clock))
</span></span><span style=display:flex><span>  ctime = ctime.read().strip().split(<span style=color:#a31515>&#39;,&#39;</span>)
</span></span><span style=display:flex><span>  city = clock.split(<span style=color:#a31515>&#39;/&#39;</span>)[1].replace(<span style=color:#a31515>&#39;_&#39;</span>, <span style=color:#a31515>&#39; &#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  draw.text((15, (idx*y)-y+10), city, fill=board.BLACK, font=small_font)
</span></span><span style=display:flex><span>  draw.text((110, (idx*y)-y+7), str(ctime[0]), fill=board.BLACK, font=big_font)
</span></span><span style=display:flex><span>  draw.text((155, (idx*y)-y+7), str(ctime[1]), fill=board.BLACK, font=big_font)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  idx += 1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>board.set_image(img)
</span></span><span style=display:flex><span>board.show()
</span></span></code></pre><p>And because eInk displays are rather slow to refresh and the clock requires
refreshing only once a minute, this can be done through cronjob.<p>Before we add this job to cron we need to make <code>clock.py</code> executable with <code>chmod +x clock.py</code>.<p>Then we add a cronjob with <code>crontab -e</code>.<pre><code>* * * * * /home/pi/clock.py
</code></pre><p>So, we end up with a result like this.<p><img src=/assets/world-clock/world-clock.jpg alt="World Clock"><p>And for the enclosure that can be 3D printed, but I haven't yet something like
this can be used.</p><iframe id=vs_iframe src="https://www.viewstl.com/?embedded&url=https%3A%2F%2Fmitjafelicijan.com%2Fassets%2Fworld-clock%2Fenclosure.stl&color=gray&bgcolor=white&edges=no&orientation=front&noborder=no" style=border:0;margin:0;width:100%;height:400px></iframe><p>You can download my <a href=/assets/world-clock/enclosure.stl>STL file for the enclosure
here</a>, but make sure that dimensions make
sense and also opening for USB port should be added or just use a drill and some
hot glue to make it stick in the enclosure.</div></div></main><footer><hr><div><h3>Want to comment or have something to add?</h3>You can write me an email at
<a href=mailto:m@mitjafelicijan.com>m@mitjafelicijan.com</a> or catch up
with me
<a href=https://telegram.me/mitjafelicijan target=_blank>on Telegram</a>.</div><hr><p>This website does not track you. Content is made available under
the <a href=https://creativecommons.org/licenses/by/4.0/ target=_blank rel=noreferrer>CC BY 4.0 license</a> unless specified
otherwise. Blog feed is available as <a href=/index.xml target=_blank>RSS feed</a>.</footer><script src=https://cdn.usefathom.com/script.js data-site=XHQARKXP defer></script>